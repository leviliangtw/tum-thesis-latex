% !TeX root = ../main.tex
% Add the above to each chapter to make compiling the PDF easier in some editors.

\chapter{Introduction}\label{chapter:introduction}

System monitoring is essential in the modern \ac{IT} industry. It offers observability to both users and developers, enabling rapid detection and notification of issues. For Amadeus's extensive network of interlinked applications, observability is vital to swiftly identifying, diagnosing, and resolving problems, ensuring our customers receive the highest quality service. 

The Amadeus Observability Platform accommodates a variety of monitoring data, including metrics, logs, structured logs, and events. It is built on the Prometheus ecosystem and integrates with Splunk. Additionally, Amadeus actively contributes to the Prometheus ecosystem. A prime example is Perses, a new CNCF project developed and maintained by Amadeus that aims at observability data visualization. 

Recently, demands for probing on kinds of applications in \ac{ACS} by customized requests, such as those of \ac{HTTP}/\ac{HTTPS}, \ac{DNS}, \ac{ICMP}, \ac{SNMP}, etc, have increased, which stemmed from the increasing focus on observability. This kind of monitoring actively sends simulated requests and observes the response without internal knowledge, which could benefit observability with low cost and fast reaction. As part of the overall strategy for rock-solid operations, Amadeus needs this kind of monitoring on scale. 

As mentioned above, the tendency brings about the demand for introducing Active Monitoring or Black Box Monitoring to Amadeus. By definition, Active Monitoring features the simulation of requests and observation of responses, covering the scope of Black Box Monitoring. However, the two monitoring methods have slight differences in concepts. Active monitoring emphasizes proactively watching the reactions to simulated behaviors~\parencite{splunkActiveVsPassive2023}. On the other side, Black Box Monitoring focuses on ignoring the internal mechanism, only caring about the input and output of the application~\parencite{beyerSiteReliabilityEngineering2016}. In conclusion, although the two monitoring methods have different names and concepts, they still feature similar behaviors and fit the latest monitoring requirements in Amadeus. 

Following alignment meetings with Platform Product Management and Tech Senior Leaders, a consensus was reached regarding the requirements for the final solution in active monitoring. The solution must be highly scalable, reliable, and cloud-ready to meet the needs of a modern \ac{IT} environment. It should support multiple protocols such as \ac{HTTP}, \ac{SOAP}, \ac{REST}, \ac{EDIFACT}, etc. Additionally, the system must be modular to facilitate the easy addition of new protocols.

Additionally, other essential features concerning the Operating Model should be considered. For example, the active monitoring platform must be self-service and fully support “as-code” configurations such as GitOps. Also, it should support deploying probers and selecting their origin and target with an easy interface. Lastly, seamless integration with the Amadeus Observability Platform, including the Event Management stack, is crucial to ensure a cohesive and efficient monitoring ecosystem.

Nowadays, there are renowned tools to implement system monitoring, such as Prometheus, Datadog, Nagios, and so on. These tools aim to collect various metrics from targets for monitoring computational resources. Generally, they provide an agent to scrape desired data and then wait for the server's request or actively push these data to the responsible server. Most of them feature great professions in monitoring, offering enterprise-level services in reaction to kinds of requirements~\parencite{nevesDetailedBlackboxMonitoring2021}.

This project considers two solutions to align with the Amadeus Observability Platform. The first is a customized application with scheduled probings, probing targets, and a centralized user interface. The third solution involves leveraging the Prometheus Operator, the Prometheus Agent, and the Blackbox Exporter to construct an integrated, compatible active monitoring platform. 

The first solution comprises three main components: the Operator, the Scheduler, and the Prober. The Operator is responsible for handling the \ac{CRD} that defines the service and related information for monitoring. The Scheduler is tasked with scheduling monitoring requests based on the \ac{CRD} and collecting data from the Probers. Lastly, the Prober is a custom worker designed for various monitoring purposes. It sends target requests and then returns the data required to the Scheduler. The significant advantage of this method is full customization; however, the disadvantages are the heavy maintenance load and the inconsistency with the open-source framework. 

The second solution mirrors the first with substitutions: the operator for the Prometheus Operator, the scheduler for the Prometheus Agent, and general probers for the Blackbox Exporter, except for certain custom probers designed for specialized protocols by Amadeus. Similar to the first solution's operator, the Operator Pattern facilitates the automation of configuration and management within container orchestration platforms like Kubernetes and OpenShift~\parencite{kubernetesOperatorPattern}. Therefore, the Prometheus Operator helps users deploy and manage the components in the ecosystem, which are needed for active monitoring, achieving sharding and auto scalability without additional effort~\parencite{prometheusoperatorIntroduction2020}. On the other hand, users must understand and utilize official \ac{CRD}s to conduct settings, which brings some learning curve to the promoting. 

In selecting the final solution, the second option involving the Prometheus Operator stands out as the preferred choice for several reasons. Firstly, the Prometheus Operator can be seen as an enhanced and official version of the first solution, offering improved compatibility. Additionally, while the first solution requires extra effort to attain scalability and availability, the Prometheus Operator naturally includes automated configuration management, evenly scraping strategy, and sharding capabilities. Lastly, the Prometheus Operator holds an advantage over another solution regarding the potential for increased support from other Prometheus-related projects. 

This thesis is organized as follows: Section 2 provides background on key concepts related to Monitoring, Prometheus, and Operator. Section 3 outlines the design of the active monitoring Platform at Amadeus, including system design, data workflow, and system integrations. Section 4 discusses design criteria and proposed solutions, such as the employment of Prometheus Agent and the combination of load balancers, highlighting their value and design decisions. Section 5 details the implementation process, focusing on integrating the Prometheus Operator into the active monitoring Platform and employing the load balancer for probers. Section 6 presents and evaluates experiments, examining the efficiency and benefits of the proposed solution. Section 7 reviews related work in the field, comparing this thesis to other projects and highlighting distinctions. Section 8 summarizes the implementation and results, underscoring the thesis's contributions. Finally, Section 9 suggests potential avenues for future research, exploring promising areas for further investigation. 


% Black box monitoring is a system analysis technique used in software testing and network monitoring. It assesses system functionality based on its output in response to certain inputs, without considering its internal mechanisms, thereby treating the system as a “black box”~\parencite{beizerBlackBoxTesting1996}~\parencite{hieronsSoftwareTestingFoundations2006}. 

% Uniping designed to enable black box monitoring for applications of \ac{OBE} and \ac{SI} in \ac{ACS} was a deprecated project in Amadeus. Recently, demands for black box monitoring in \ac{ACS} have increased, leading to the reboot of this project. Therefore, the goal for Amadeus is to enhance Uniping in \ac{ACS} for distributed and reliable Black Box Monitoring and contribute Uniping to the Open Source Community as an innovative solution in the realm of system monitoring. 

% Uniping is composed of three main components: the Operator, the Scheduler, and the Pinger. The Operator is responsible for handling the \ac{CRD} that defines the service and related information for monitoring. The Scheduler is tasked with scheduling monitoring requests based on the \ac{CRD} and collecting data from the Pingers. Lastly, the Pinger is a custom worker designed for various monitoring purposes. It sends requests to targets and then returns the necessary data back to the Scheduler.

% However, Uniping has several limitations, including a single point of failure, lack of scalability, and limited customizability. Specifically, the Scheduler, which dispatches monitoring requests and collects response data, represents a single point of failure and could potentially become a traffic bottleneck. Furthermore, Uniping can only be deployed to OpenShift Clusters individually, with no common control plane for all Unipings deployed across different clusters. These design and architectural issues pose significant challenges for the rebooted project, especially for other teams within Amadeus who rely on Uniping for reliable black box monitoring of a large number of distributed and cross-cluster services. 

% Nowadays, there are renowned tools to implement system monitoring such as Prometheus, Datadog, Nagios, and so on. These tools aim to collect a variety of metrics from targets for monitoring computational resources. Generally, they provide an agent to scrape desired data and then wait for the server's request or actively push these data to the responsible server. Most of them feature great professionals in the realm of monitoring, offering enterprise-level services in reaction to kinds of requirements~\parencite{nevesDetailedBlackboxMonitoring2021}.

% Uniping aims to provide real-time monitoring, logging, and analysis capabilities. These features enable system administrators to quickly detect and diagnose issues, thereby improving system reliability and performance~\parencite{jorgensenSoftwareTestingCraftsman2021}. Furthermore, the proposed improvements to Uniping will offer scalability, availability, and failure tolerance through a redesigning and refactoring of the system architecture. Consequently, the objective of the project is to redesign and implement an open-source black box monitoring system that meets current requirements in the context of distributed architecture.
